const { minify } = require("html-minifier");

module.exports = function (eleventyConfig) {
  eleventyConfig.addFilter('slugify', input => {
    return input?.normalize()
      .trim()
      .toLowerCase()
      .replace(/[():%]/g, '')
      .replace(/[ ']/g, '-')
      .replace(/Ã©/g, 'e')
  })

  eleventyConfig.addTransform('htmlmin', (content, outputPath) => {
    if (outputPath.endsWith('.html')) {
      return minify(content, {
        collapseBooleanAttributes: true,
        collapseWhitespace: true,
        decodeEntities: true,
        includeAutoGeneratedTags: false,
        minifyCSS: true,
        removeAttributeQuotes: true,
        removeComments: true,
        removeOptionalTags: true,
        removeRedundantAttributes: true,
        sortAttributes: true
      })
    } else {
      return content
    }
  })
}